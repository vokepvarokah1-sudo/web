<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Video</title>

<style>
body {
  background:#000;
  color:#fff;
  max-width:900px;
  margin:auto;
  padding:10px;
  font-family:Arial,Helvetica,sans-serif;
}

.player-wrapper {
  position:relative;
  width:100%;
  background:#000;
}

.player-wrapper::before {
  content:"";
  display:block;
  padding-top:56.25%;
}
@media(max-width:768px){
  .player-wrapper::before{padding-top:177.77%;}
}

#message {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  text-align:center;
  background:#000;
  z-index:1;
  font-size:16px;
}

#player {
  position:absolute;
  inset:0;
  z-index:2;
  display:none;
}

.controls {
  display:flex;
  gap:10px;
  margin-top:15px;
}
button {
  flex:1;
  padding:12px;
  font-size:16px;
  border:none;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="player-wrapper">
  <div id="message">
    Matikan adsblock untuk menonton<br>
    <small>Turn off adsblock to watch</small>
  </div>
  <div id="player"></div>
</div>

<div class="controls">
  <button id="nextBtn">Next</button>
  <button id="downloadBtn">Download</button>
</div>

<script>
const GIST_URL = "https://gist.githubusercontent.com/vokepvarokah1-sudo/e19d30781bf904e4419135f16a35092e/raw/c50ab1e32f20e0e1ceca3f3451aab4d026acf0c3";
const STORAGE_KEY = "played_videos";
let currentVideo=null;

/* ===== DETEKSI BRAVE / ADBLOCK ===== */
async function isBlocked(){
  // Brave check
  if (navigator.brave && await navigator.brave.isBrave()) {
    return true;
  }
  // Ads bait check
  const bait=document.createElement("div");
  bait.className="adsbox";
  bait.style.height="1px";
  document.body.appendChild(bait);
  const blocked=bait.offsetHeight===0;
  bait.remove();
  return blocked;
}

/* ===== VIDEO LOGIC ===== */
async function fetchVideos(){
  const r=await fetch(GIST_URL);
  return await r.json();
}

function getPlayed(){
  return JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
}
function savePlayed(id){
  const p=getPlayed();p.push(id);
  localStorage.setItem(STORAGE_KEY,JSON.stringify(p));
}

function pickRandom(videos){
  let played=getPlayed();
  let avail=videos.filter(v=>!played.includes(v.id));
  if(avail.length===0){
    localStorage.removeItem(STORAGE_KEY);
    avail=videos;
  }
  return avail[Math.floor(Math.random()*avail.length)];
}

function renderVideo(video){
  currentVideo=video;
  document.getElementById("player").innerHTML=`
    <video src="${video.play}" controls autoplay playsinline
    style="width:100%;height:100%;background:#000"></video>`;
  document.getElementById("downloadBtn").onclick=()=>{
    location.href=video.download;
  };
}

async function init(){
  const blocked=await isBlocked();
  if(blocked){
    document.getElementById("player").style.display="none";
    document.getElementById("message").style.display="flex";
    return;
  }
  document.getElementById("message").style.display="none";
  document.getElementById("player").style.display="block";

  const videos=await fetchVideos();
  const video=pickRandom(videos);
  savePlayed(video.id);
  renderVideo(video);
}

document.getElementById("nextBtn").onclick=init;
init();
</script>

</body>
</html>
